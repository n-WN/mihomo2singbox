# Mihomo to Sing-box è½¬æ¢å™¨ - sing-box 1.12.0 å…¼å®¹æ€§çŠ¶æ€

## ğŸ‰ è½¬æ¢å®ŒæˆçŠ¶æ€

è½¬æ¢å™¨å·²æˆåŠŸé€‚é… sing-box 1.12.0 çš„æ–°æ ¼å¼è¦æ±‚ï¼Œæ‰€æœ‰ä¸»è¦åŠŸèƒ½å‡æ­£å¸¸å·¥ä½œã€‚

## âœ… å·²å®ç°çš„åŠŸèƒ½

### 1. æ’ä»¶é…ç½®æ ¼å¼ä¿®å¤
- **é—®é¢˜**: sing-box è¦æ±‚ `plugin_opts` ä¸ºå­—ç¬¦ä¸²æ ¼å¼ï¼Œä½†è½¬æ¢å™¨ç”Ÿæˆäº†å¯¹è±¡æ ¼å¼
- **è§£å†³**: æ·»åŠ  `_convert_plugin_opts_to_string()` æ–¹æ³•ï¼Œæ­£ç¡®è½¬æ¢æ’ä»¶é€‰é¡¹
- **æ”¯æŒ**: obfs-local, v2ray-plugin ç­‰æ’ä»¶çš„é€‰é¡¹å­—ç¬¦ä¸²åŒ–

### 2. DNS é…ç½®å‡çº§ (1.12.0+ æ ¼å¼)
- **æ–°æ ¼å¼**: ä½¿ç”¨ `servers` æ•°ç»„æ›¿ä»£æ—§çš„ `nameserver` å­—æ®µ
- **ç‰¹æ€§**: æ”¯æŒæœåŠ¡å™¨æ ‡ç­¾ã€åˆ†æµè·¯ç”±ã€DNS è§„åˆ™åŠ¨ä½œ
- **åŠ¨ä½œ**: å®ç° `route` å’Œ `reject` åŠ¨ä½œç±»å‹

### 3. Shadowsocks é…ç½®ä¼˜åŒ–
- **æ’ä»¶**: æ­£ç¡®æ”¯æŒ `obfs-local` æ’ä»¶
- **ç½‘ç»œ**: æ˜ç¡®é…ç½® TCP/UDP æ”¯æŒ
- **é€‰é¡¹**: æ’ä»¶é€‰é¡¹æ ¼å¼åŒ–ä¸ºæ­£ç¡®çš„å­—ç¬¦ä¸²æ ¼å¼

### 4. è·¯ç”±è§„åˆ™ç°ä»£åŒ–
- **åŠ¨ä½œæ ¼å¼**: ä½¿ç”¨æ–°çš„ `action` å­—æ®µæ›¿ä»£é—ç•™çš„ç‰¹æ®Šå‡ºç«™
- **æ‹’ç»è§„åˆ™**: åŒ…å« `method` å­—æ®µæŒ‡å®šæ‹’ç»æ–¹å¼
- **Rule-sets**: æ”¯æŒè¿œç¨‹è§„åˆ™é›†æ›¿ä»£å†…ç½® GeoIP/Geosite

### 5. é…ç½®éªŒè¯
- **æ£€æŸ¥**: ç”Ÿæˆçš„é…ç½®é€šè¿‡ `sing-box check` éªŒè¯
- **æ ¼å¼**: å®Œå…¨ç¬¦åˆ 1.12.0 æ ¼å¼è¦æ±‚
- **å…¼å®¹**: æ— é—ç•™æ ¼å¼æˆ–ä¸æ”¯æŒçš„é…ç½®é¡¹

## ğŸ“Š è½¬æ¢ç»Ÿè®¡ (åŸºäºæµ‹è¯•é…ç½®)

- **DNS æœåŠ¡å™¨**: 7ä¸ª (åŒ…å«æœ¬åœ°DNS)
- **å‡ºç«™é…ç½®**: 1485ä¸ª
  - Shadowsocks: 1463ä¸ª
  - é€‰æ‹©å™¨: 21ä¸ª
  - ç›´è¿: 1ä¸ª
- **è·¯ç”±è§„åˆ™**: 25,387ä¸ª
  - åŸŸåè§„åˆ™: å¤§éƒ¨åˆ†
  - ç›´è¿è§„åˆ™: é€‚å½“æ•°é‡
  - ä»£ç†è§„åˆ™: å¤§éƒ¨åˆ†

## ğŸ”§ æŠ€æœ¯æ”¹è¿›

### æ’ä»¶é€‰é¡¹è½¬æ¢
```python
def _convert_plugin_opts_to_string(self, plugin: str, opts: Dict) -> str:
    if plugin == "obfs":
        result = []
        if "mode" in opts:
            result.append(f"obfs={opts['mode']}")
        if "host" in opts:
            result.append(f"obfs-host={opts['host']}")
        return ";".join(result)
```

### DNS 1.12.0+ æ ¼å¼
```json
{
  "dns": {
    "servers": [
      {
        "tag": "local",
        "address": "local",
        "detour": "direct"
      }
    ],
    "rules": [
      {
        "action": "route",
        "server": "dns_0"
      }
    ]
  }
}
```

### è·¯ç”±è§„åˆ™åŠ¨ä½œ
```json
{
  "route": {
    "rules": [
      {
        "domain": ["example.com"],
        "action": "reject",
        "method": "default"
      }
    ]
  }
}
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

```bash
# è½¬æ¢é…ç½®
uv run main.py input.yaml -o output.json

# éªŒè¯é…ç½®
sing-box check -c output.json

# ä½¿ç”¨é…ç½®
sing-box run -c output.json
```

## âš¡ æ€§èƒ½ä¼˜åŒ–

- **Rule-sets**: ä½¿ç”¨è¿œç¨‹è§„åˆ™é›†å‡å°‘é…ç½®æ–‡ä»¶å¤§å°
- **ç¼“å­˜**: å¯ç”¨å®éªŒæ€§ç¼“å­˜åŠŸèƒ½æé«˜æ€§èƒ½
- **æ ¼å¼**: ä½¿ç”¨äºŒè¿›åˆ¶æ ¼å¼çš„è§„åˆ™é›†æé«˜åŠ è½½é€Ÿåº¦

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

1. **æµ‹è¯•è¦†ç›–**: å¢åŠ æ›´å¤šé…ç½®æ ¼å¼çš„æµ‹è¯•ç”¨ä¾‹
2. **é”™è¯¯å¤„ç†**: å®Œå–„è¾¹ç¼˜æƒ…å†µçš„å¤„ç†
3. **æ€§èƒ½ä¼˜åŒ–**: è¿›ä¸€æ­¥ä¼˜åŒ–è§„åˆ™è½¬æ¢æ€§èƒ½
4. **æ–‡æ¡£**: æ·»åŠ ä½¿ç”¨è¯´æ˜å’Œæœ€ä½³å®è·µ

---

**çŠ¶æ€**: âœ… å·²å®Œæˆ - è½¬æ¢å™¨å®Œå…¨ç¬¦åˆ sing-box 1.12.0 æ ¼å¼è¦æ±‚
**æµ‹è¯•**: âœ… é€šè¿‡ - æ‰€æœ‰æµ‹è¯•é…ç½®éƒ½èƒ½æ­£ç¡®è½¬æ¢å¹¶é€šè¿‡éªŒè¯
**å…¼å®¹æ€§**: âœ… è‰¯å¥½ - æ”¯æŒæœ€æ–°çš„ sing-box æ ¼å¼æ ‡å‡†
